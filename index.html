



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>FlowKit</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://unpkg.com/mermaid@7.1.2/dist/mermaid.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="#095798" data-md-color-accent="#2977b8">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#flowkit" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="." title="FlowKit" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              FlowKit
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/Flowminder/FlowKit" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Flowminder/FlowKit
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
      
        
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="." title="FlowKit" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    FlowKit
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/Flowminder/FlowKit" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Flowminder/FlowKit
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="introduction/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="flowclient/" title="Analyst" class="md-nav__link">
      Analyst
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="developer/roadmap/" title="Developer" class="md-nav__link">
      Developer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="administrator/cache_management/" title="Administrator" class="md-nav__link">
      Administrator
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation-using-docker-cloud-repositories" title="Installation using docker cloud repositories" class="md-nav__link">
    Installation using docker cloud repositories
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server" title="Server" class="md-nav__link">
    Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client" title="Client" class="md-nav__link">
    Client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flowauth" title="FlowAuth" class="md-nav__link">
    FlowAuth
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation-for-developers" title="Installation for developers" class="md-nav__link">
    Installation for developers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-with-secrets" title="Running with Secrets" class="md-nav__link">
    Running with Secrets
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secrets-quickstart" title="Secrets Quickstart" class="md-nav__link">
    Secrets Quickstart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="flowkit">FlowKit<a class="headerlink" href="#flowkit" title="Permanent link">&para;</a></h1>
<p>FlowKit is a platform for analysis of CDR and other data. The system is designed to be deployed as a set of <a href="https://docs.docker.com">Docker</a> containers on a server. The three main server components are:</p>
<ul>
<li>
<p><a href="./flowdb">FlowDB</a></p>
<p>A <a href="https://www.postgresql.org">PostgreSQL</a> database for storing and serving mobile operator data.</p>
</li>
<li>
<p><a href="./flowmachine">FlowMachine</a></p>
<p>A Python toolkit for the analysis of CDR data.</p>
</li>
<li>
<p><a href="./flowapi">FlowAPI</a></p>
<p>An HTTP API which provides access to the functionality of FlowMachine, and handles access control.</p>
</li>
</ul>
<p>In addition, <a href="http://zeromq.org/">ZeroMQ</a> is used for communication between FlowAPI and FlowMachine, and FlowMachine uses <a href="https://redis.io/">Redis</a> for interprocess communication. <a href="http://jwt.io">JSON Web Tokens</a> are used for access control in FlowAPI.</p>
<p>There are two other components of FlowKit:</p>
<ul>
<li>
<p><a href="./flowclient">FlowClient</a></p>
<p>A Python client to FlowAPI.</p>
</li>
<li>
<p><a href="./flowauth">FlowAuth</a></p>
<p>An authentication management system used to generate access tokens for use with FlowClient.</p>
</li>
</ul>
<p>FlowKit is an open-source product. The source code can be found at <a href="https://github.com/Flowminder/FlowKit">https://github.com/Flowminder/FlowKit</a>, and documentation is available at <a href="https://flowminder.github.io/FlowKit">https://flowminder.github.io/FlowKit</a>. </p>
<p>FlowKit is in active development, visit the project's  <a href="developer/roadmap">roadmap</a> to get a sense about upcoming developments.</p>
<h2 id="installation-using-docker-cloud-repositories">Installation using docker cloud repositories<a class="headerlink" href="#installation-using-docker-cloud-repositories" title="Permanent link">&para;</a></h2>
<h3 id="server">Server<a class="headerlink" href="#server" title="Permanent link">&para;</a></h3>
<p>Docker containers for FlowAPI, FlowMachine and FlowDB are provided in the docker cloud repositories <code>flowminder/flowapi</code>, <code>flowminder/flowmachine</code> and <code>flowminder/flowdb</code>, respectively. To set up FlowKit using the docker cloud repositories, you will need <a href="https://docs.docker.com/install/">Docker</a> and <a href="https://docs.docker.com/compose/install/">Docker Compose</a>.</p>
<p>The file <a href="https://github.com/Flowminder/FlowKit/raw/master/docker-compose.yml"><code>docker-compose.yml</code></a> can be used to start FlowKit and populate FlowDB with a test dataset. The compose file expects the <code>JWT_SECRET_KEY</code> environment variable to be set. This is used to sign and verify access tokens for the API.</p>
<p>The FlowKit test system can be started by running <code>JWT_SECRET_KEY=&lt;secret&gt; docker-compose up -d</code> in the same directory as the <code>docker-compose.yml</code> file. This will pull any necessary docker containers, and start the system in the background with the API exposed on port <code>9090</code> by default.</p>
<h3 id="client">Client<a class="headerlink" href="#client" title="Permanent link">&para;</a></h3>
<p>The FlowClient Python client may be installed using pip:</p>
<div class="codehilite"><pre><span></span>pip install flowclient
</pre></div>

<p>Details of FlowClient usage can be found <a href="./flowclient">here</a>.</p>
<h3 id="flowauth">FlowAuth<a class="headerlink" href="#flowauth" title="Permanent link">&para;</a></h3>
<p>The FlowAuth Docker container is provided in the docker cloud repository <code>flowminder/flowauth</code>. Deployment and usage instructions can be found <a href="./flowauth">here</a>.</p>
<h2 id="installation-for-developers">Installation for developers<a class="headerlink" href="#installation-for-developers" title="Permanent link">&para;</a></h2>
<p>After cloning the <a href="https://github.com/Flowminder/FlowKit">GitHub repository</a>, the FlowKit system can be started by running <code>make up</code> in the root directory. This requires <a href="https://docs.docker.com/install/">Docker</a> and <a href="https://docs.docker.com/compose/install/">Docker Compose</a> to be installed, and starts the flowapi, flowmachine, flowdb and redis docker containers using the <code>docker-compose-dev.yml</code> file.</p>
<p>FlowKit uses <a href="https://pipenv.readthedocs.io/">pipenv</a> to manage Python environments. To start a Python session in which you can use FlowClient:</p>
<div class="codehilite"><pre><span></span>cd flowclient
pipenv install
pipenv run python
&gt;&gt;&gt; import flowclient
</pre></div>

<p>To run the tests in the <code>flowapi</code>, <code>flowclient</code>, <code>flowdb</code>, <code>flowmachine</code> or <code>integration_tests</code> directory:</p>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> &lt;directory&gt;
pipenv install --dev
pipenv run pytest
</pre></div>

<h2 id="running-with-secrets">Running with Secrets<a class="headerlink" href="#running-with-secrets" title="Permanent link">&para;</a></h2>
<p>The standard Docker compose file supplies a number of 'secret' values as environment variables. Typically, this is a bad idea.</p>
<p>Instead, you should make use of <a href="https://docs.docker.com/engine/swarm/secrets/">docker secrets</a>, which are stored securely in docker and only made available <em>inside</em> containers.  The <code>secrets_quickstart</code> directory contains a <a href="https://docs.docker.com/docker-cloud/apps/stack-yaml-reference/">docker <em>stack</em></a> file (<code>docker-stack.yml</code>). The stack file is very similar to a compose file, but removes container names, and adds a new section - secrets.</p>
<p>The stack expects you to provide seven secrets:</p>
<ul>
<li>
<p>cert-flowkit.pem</p>
<p>An SSL certificate file (should contain private key as well)</p>
</li>
<li>
<p>API_DB_USER</p>
<p>The username the API will use to connect to FlowDB</p>
</li>
<li>
<p>API_DB_PASS</p>
<p>The password that the API will use to connect to FlowDB</p>
</li>
<li>
<p>FM_DB_USER</p>
<p>The username that FlowMachine will use to connect to FlowDB</p>
</li>
<li>
<p>FM_DB_PASS </p>
<p>The password that FlowMachine will use to connect to FlowDB</p>
</li>
<li>
<p>POSTGRES_PASSWORD_FILE</p>
<p>The superuser password for the <code>flowdb</code> user </p>
</li>
<li>
<p>JWT_SECRET_KEY</p>
<p>The secret key used to sign API access tokens</p>
</li>
<li>
<p>REDIS_PASSWORD_FILE</p>
<p>The password protecting the redis instance</p>
</li>
</ul>
<p>To make use of secrets you will need to use docker swarm. For testing purposes, you can set up a single node swarm by running <code>docker swarm init</code>.</p>
<p>Once you have created a swarm, you can add secrets to it using the <a href="https://docs.docker.com/engine/reference/commandline/secret_create/">docker secret</a> command. For example, to add a randomly generated password for the <code>FM_DB_PASS</code> secret:</p>
<div class="codehilite"><pre><span></span>openssl rand -base64 <span class="m">16</span> <span class="p">|</span> docker secret create FM_DB_PASS -
</pre></div>

<p>And to add the (unsigned) localhost SSL certificate supplied in the <code>integration_tests</code> directory:</p>
<div class="codehilite"><pre><span></span>docker secret create cert-flowkit.pem integration_tests/cert.pem
</pre></div>

<p>(Note that unlike the other examples, we are supplying a <em>file</em> rather than piping to stdin.)</p>
<p>Once you have added all five required secrets, you can use <code>docker stack</code> to spin up FlowKit, much as you would <code>docker-compose</code>:</p>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> secrets_quickstart
docker stack deploy --with-registry-auth -c docker-stack.yml secrets_test
</pre></div>

<p>After which, the API will be available via HTTPS (and no longer available via HTTP). Note that to access the API using FlowClient, you'll need to provide the path to the certificate as the <code>ssl_certificate</code> argument when calling <code>flowclient.Connection</code> (much as you would if using a self-signed certificate with <code>requests</code>):</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">flowclient</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">flowclient</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="s2">&quot;https://localhost:9090&quot;</span><span class="p">,</span> <span class="s2">&quot;JWT_STRING&quot;</span><span class="p">,</span> <span class="n">ssl_certificate</span><span class="o">=</span><span class="s2">&quot;/home/username/flowkit/integration_tests/client_cert.pem&quot;</span><span class="p">)</span>
</pre></div>

<h3 id="secrets-quickstart">Secrets Quickstart<a class="headerlink" href="#secrets-quickstart" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> secrets_quickstart
pipenv run secrets_quickstart
</pre></div>

<p>This will bring up a single node swarm, create random 16 character passwords for the database users, generate a certificate valid for the <code>flowkit.api</code> domain (and point that to <code>localhost</code> using <code>/etc/hosts</code>), pull all necessary containers, and bring up the API with <code>secret</code> as the JWT secret key.</p>
<p>Note that if you wish to deploy a branch other than master, you should set the <code>CIRCLE_BRANCH</code> environment variable before running, to ensure that Docker pulls the correct tags.</p>
<p>You can then provide the certificate to <code>flowclient</code>, and finally connect via https:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">flowclient</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">flowclient</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="s2">&quot;https://localhost:9090&quot;</span><span class="p">,</span> <span class="s2">&quot;JWT_STRING&quot;</span><span class="p">,</span> <span class="n">ssl_certificate</span><span class="o">=</span><span class="s2">&quot;&lt;path_to_cert.pem&gt;&quot;</span><span class="p">)</span>
</pre></div>

<p>(This generates a certificate valid for the <code>flow.api</code> domain as well, which you can use by adding a corresponding entry to your <code>/etc/hosts</code> file.)</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="assets/fonts/font-awesome.css">
    
      <a href="https://github.com/Flowminder" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/Flowminder" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
        <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
      
    
    
      
    
  </body>
</html>