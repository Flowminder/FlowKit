# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.
#
# DOCKER COMPOSE FOR FLOWKIT SYNTHETIC DATA
#

version: '3.5'

services:

  flowdb:
    container_name: flowdb
    image: flowminder/flowdb-synthetic-data:${CONTAINER_TAG:-latest}
    environment:
      SYNTHETIC_DATA_GENERATOR: ${SYNTHETIC_DATA_GENERATOR:?Must set SYNTHETIC_DATA_GENERATOR env var}
      N_SITES: ${N_SITES:?Must set N_SITES env var}
      N_CELLS: ${N_CELLS:?Must set N_CELLS env var}
      N_SUBSCRIBERS: ${N_SUBSCRIBERS:?Must set N_SUBSCRIBERS env var}
      N_DAYS: ${N_DAYS:?Must set N_DAYS env var}
      N_CALLS: ${N_CALLS:?Must set N_CALLS env var}
      N_SMS: ${N_SMS:?Must set N_SMS env var}
      N_MDS: ${N_MDS:?Must set N_MDS env var}
      N_TACS: ${N_TACS:?Must set N_TACS env var}
      N_MEAN_CALLS: ${N_MEAN_CALLS:?Must set N_MEAN_CALLS env var}
      N_SD_CALLS: ${N_SD_CALLS:?Must set N_SD_CALLS env var}
      N_MEAN_SMS: ${N_MEAN_SMS:?Must set N_MEAN_SMS env var}
      N_SD_SMS: ${N_SD_SMS:?Must set N_SD_SMS env var}
      N_MEAN_MDS: ${N_MEAN_MDS:?Must set N_MEAN_MDS env var}
      N_SD_MDS: ${N_SD_MDS:?Must set N_SD_MDS env var}
      N_STARTDATE: ${N_STARTDATE:?Must set N_STARTDATE env var}
      P_OUT_OF_AREA: ${P_OUT_OF_AREA:?Must set P_OUT_OF_AREA env var}
      P_RELOCATE: ${P_RELOCATE:?Must set P_RELOCATE env var}
      INTERACTIONS_MULTIPLIER: ${INTERACTIONS_MULTIPLIER:?Must set INTERACTIONS_MULTIPLIER env var}
      DISASTER_START: ${DISASTER_START:?Must set DISASTER_START env var}
      DISASTER_END: ${DISASTER_END:?Must set DISASTER_END env var}
      SUBSCRIBERS_SEED: ${SUBSCRIBERS_SEED:?Must set SUBSCRIBERS_SEED env var}
      CELLS_SEED: ${CELLS_SEED:?Must set CELLS_SEED env var}
      CALLS_SEED: ${CALLS_SEED:?Must set CALLS_SEED env var}
      OUTPUT_ROOT_DIR: ${OUTPUT_ROOT_DIR:?Must set OUTPUT_ROOT_DIR env var}
    shm_size: 1G
    tty: true
    stdin_open: true
    restart: always
    networks:
      db:
        aliases:
          - flowdb
